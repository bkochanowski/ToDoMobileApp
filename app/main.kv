# kivy 2.0.0.
#: import icon kivy.garden.iconfonts.icon
#: import mtx kivy.metrics
#: import DatePicker datepicker.datepicker.DatePicker

<MainWindow>:
    BoxLayout:
        orientation: "vertical"
        BoxLayout:
            size_hint: 1, None
            size_hint_y: .1
			canvas.before:
				Color:
					rgba: 0, .45,0,.8
				Rectangle:
					pos: self.pos
					size: self.size
			BoxLayout:
				padding: 15,5,5,5
				MenuButton:
					text: icon('zmdi-menu')
					markup: True
					text_size: self.size
					font_size: mtx.sp(24)
					valign: 'middle'
					on_release:
						print("I've been pressed")
				BoxLayout:
				    halign: 'right'
                    Button:
                        text: 'Zadania'
                        on_release: scrn_mngr.current = 'shop_scrn'
                    Button:
                        text: 'Zakupy'
                        on_release: scrn_mngr.current = 'shop_scrn'
        BoxLayout:
            size_hint_y: .82
            ScreenManager:
                id: scrn_mngr
                TaskScreen:
                ShoppingScreen:
        MenuButton:
            size_hint_y: .08
            canvas.before:
    		    Color:
    				rgba: 0, .45,0,.8
    			Rectangle:
    				pos: self.pos
    				size: self.size

<TaskScreen>
    name: 'task_scrn'
	BoxLayout:
		orientation: 'vertical'
		canvas.before:
			Color:
				rgba: 1,1,1,1
			Rectangle:
				pos: self.pos
				size: self.size
		BoxLayout:
			size_hint_y: .85
			orientation: 'vertical'
			BoxLayout:
				size_hint_y: .1
				padding: [10,0]
				Label:
					text: icon('zmdi-arrow-forward')
					color: 0,0,0,1
					markup: True
					font_size: mtx.sp(24)
					size_hint_x: .1
					valign: 'top'
				Widget:
					size_hint_x: .4
				Label:
					text: 'NADCHODZĄCE'
					font_size: mtx.sp(14)
					bold: True
					size_hint_x: .5
					color: 0,0,0,1
					text_size: self.size
					halign: 'right'
					valign: 'center'
			BoxLayout:
				size_hint_y: .6
				id: scroll_parent
				ScrollView:
					id: sv_upcoming
					do_scroll: [True, False]
					scroll_type: ['content']
					size_hint_y: None
					height: self.parent.height
					effect_cls: 'ScrollEffect'
					GridLayout:
						id: upcoming_wrapper
						rows: 1
						padding: ['10dp', '10dp','10dp', '20dp']
						spacing: mtx.dp(20)
						size: self.minimum_size
						size_hint: [None, None]

						# 1 random task below to test GridLayout display
						Task:
							name: 'Zadanie #1'
							details: 'Zrób aplikację. \n Utwórz mechanizm listy zakupów.'
							time: '22:02'
							size_hint: [None,None]
							size: [scroll_parent.width/1.5, scroll_parent.height-(.050*scroll_parent.height)]
						Task:
							name: 'Zadanie #2'
							details: 'Przerzuć każdy screen do innego pliku kv.'
							time: '20:02'
							size_hint: [None,None]
							size: [scroll_parent.width/1.5, scroll_parent.height-(.050*scroll_parent.height)]

						NewButton:
							on_release: root.add_new()
							size_hint: [None,None]
							size: [scroll_parent.width/1.5, scroll_parent.height-(.050*scroll_parent.height)]
		Widget:
			size_hint_y: .05


<ShoppingScreen>:
    name: 'shop_scrn'
	orientation: 'vertical'
    BoxLayout:
		orientation: 'vertical'
		canvas.before:
			Color:
				rgba: 0,0,1,1
			Rectangle:
				pos: self.pos
				size: self.size

<NewTask>:
	size_hint: [.8,.7]
	BoxLayout:
		orientation: 'vertical'
		spacing: '12dp'
		padding: '10dp'
		canvas.before:
			Color:
				rgba: 1,1,1,1
			RoundedRectangle:
				pos: self.pos
				size: self.size
				radius: [7]
		BoxLayout:
			size_hint_y: .15
			padding: '4dp'
			FlatInput:
				id: task_name
				hint_text: 'Wpisz nazwę zadania'
				hint_text_color: 1,1,1,1
		BoxLayout:
            size_hint_y: .15
            padding: '4dp'
            FlatInput:
                id: task_details
                hint_text: 'Wpisz szczegóły zadania'
                hint_text_color: 1,1,1,1
		Widget:
			size_hint_y: .1
		BoxLayout:
			id: datetime
			size_hint_y: .12
			padding: '4dp'
			DatePicker:
				id: task_date
				size_hint_x: .5
#				background_active: ''
#				background_normal: ''
#				background_color: 1,1,1,0
#				canvas.before:
#					Color:
#						rgba: [0,.3,0,.7]
#					Rectangle:
#						pos: self.pos
#						size: [self.size[0], 1]
			MenuButton:
				id: task_time
				text: '00:00:00'
				color: 0,0,0,1
				size_hint_x: .5
				on_release: root.get_time()
		Widget:
			size_hint_y: .2
		MenuButton:
			text: 'Zapisz'
			bold: True
			size_hint_y: .2
# path below needs to be updated!!! wrong path!
			on_release: app.root.add_task(root, (task_name, task_details, task_date, task_time))
			canvas.before:
				Color:
					rgba: 0,.3,0,.7
				RoundedRectangle:
					pos: self.pos
					size: self.size


<Task>:
    orientation: 'vertical'
	padding: mtx.dp(15)
    canvas.before:
        Color:
            rgba: [0, 0, .5, .35]
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [20]
    Label:
        id: task_name
        text: root.name
		bold: True
		font_size: mtx.sp(20)
        size_hint_y: .1
        color: 0,0,0,1
		text_size: None, self.texture_size[1]
		size: self.size
		shorten: True
		shorten_from: 'right'
		halign: 'right'
	BoxLayout:
		size_hint_y: .07
		Label:
			text: icon('zmdi-time-countdown')
			markup: True
			size_hint_y: .8
			size_hint_x: .15
			color: 1,1,1,.9
			halign: 'left'
		Label:
			id: task_time
			text: root.time
			size_hint_y: .80
			text_size: self.size
			color: 1,1,1,.9
			halign: 'left'
	Label:
		size_hint_y: .38
        id: task_details
        text: root.details
        multiline: True
        font_size: mtx.sp(12)
        color: 0,0,0,1
        text_size: None, self.texture_size[1]
        size: self.size
        halign: 'right'
        shorten: True
        shorten_from: 'right'
    BoxLayout:
    	size_hint_y: .3
    AnchorLayout:
        anchor_x: 'right'
        anchor_y: 'bottom'
        size_hint_y: .1
        MenuButton:
            text: icon('zmdi-delete')
            markup: True
            font_size: '24sp'
            size_hint_x: .3
            color: 1,1,1,1
			on_release: root.parent.remove_widget(root)


<NewButton>:
	canvas.before:
		Color:
			rgba: [0, 0, 0, .15]
		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius: [20]
	Label:
		text: icon('zmdi-plus')
		font_size: mtx.sp(58)
		markup: True

<MenuButton@Button>:
    background_normal: ''
    background_color: 1,1,1,0

<FlatInput@TextInput>:
	background_active: ''
	background_normal: ''
	background_color: 1,1,1,0
	canvas.before:
		Color:
			rgba: [0,0,0,1]
		Rectangle:
			pos: self.pos
			size: [self.size[0], 2]